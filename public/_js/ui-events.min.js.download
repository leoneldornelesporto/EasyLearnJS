/*! ppplusbrcpmnodeweb 01-10-2021 */
define(["jquery","cache","defaults","installmentsHelper","nameValidation","billingAddressValidation","statesHelper","rememberMeHelper","utility","messageController","resolutionHelper","creditCardHelper","domHelper","cardDetails","inlineCheckoutController"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(){a("*[class^='confirm-remove']").addClass("hide"),a("*[id^='remove-card']").show()}function q(){a(".dropdown-menu li a").click(function(){var c,e=a(this).parents(".btn-group").find(".dropdown-toggle"),f=a(e).get(0).id||"";if("select-installments"===f){c=a(this).find(".installment-term").text();c=c+' <span class="saveThis">'+(a(this).find(".discount").text()||"")+"</span>",b.lastSelectedTerm=a(this).attr("term"),d.selectInstallmentTerm(a(this).attr("term"),a(this).attr("data-pp-internal"))}else c=a(this).text();a(e).html(c),a(e).removeClass("select-error"),j.hideErrorMessages(),a("#spinner").addClass("hide"),i.postMessage("enableContinueButton")})}function r(){a(".installmentsContainer").on("change",function(){b.lastSelectedTerm>0&&a(document).find("#select-installments").length>0&&d.loadInstallment(b.lastSelectedTerm)})}function s(){a(document).on("contextmenu",function(a){a.preventDefault()})}function t(){a("input[name='ccSelection']").on("change",function(c){var e=a(c.target);if(j.hideErrorMessages(),p(),h.getRememberedMeCards().length>=3&&a("#add-card-true").prop("checked",!1),a("#add-card-true").is(":checked")||!a("#remembered-cards"))if(b.updatePreviousBin(""),a(m.ccEntryForm).removeClass("hide"),a("#remember-card-div").removeClass("hide"),h.hideRememberMeCsc(),b.supportsInstallments){var f=a("#credit-card-inline").val().replace(/\D/g,"");f?(b.updatePreviousBin(""),a("#cardicon").attr("class","cardicon Generic"),a("#credit-card-inline").trigger("keydown")):d.hasFixedInstallment()?d.showCcFixedInstallmentOption():d.showDefaultInstallments()}else d.showCcEntrySingleInstallmentOption();else{a(m.ccEntryForm).addClass("hide"),a("#remember-card-div").addClass("hide");var g,k;if(c.isTrigger?(g=h.getRememberCardPresentRequired(0),k=h.getRememberCardType(0)):(g=a(e).attr("cardPresentRequired"),k=a(e).attr("value")),h.loadRememberMeInstallment(this,d,l),g&&"0"!==g){var n=l.getCardMetaData(k);h.showRememberMeCsc(),l.cscFormatter(n)}else h.hideRememberMeCsc()}b.lastSelectedTerm>0&&a(document).find("#select-installments").length>0&&d.loadInstallment(b.lastSelectedTerm),q(),a("#spinner").addClass("hide"),i.postMessage("enableContinueButton")})}function u(){a("#add-card").on("click",function(){a("#add-card-true").prop("checked",!0),a("input[name='ccSelection']").change(),j.hideErrorMessages(),a("#spinner").addClass("hide"),i.postMessage("enableContinueButton")})}function v(){a('span[id^="remove-card"]').on("click",function(){a(this).hide();var b=a(this).context.parentNode;a(b.children[0]).removeClass("hide"),j.hideErrorMessages()})}function w(){a("#country").change(function(){var b=a("#country").val();if("Country"!==b){a("#spinner").removeClass("hide"),i.postMessage("disableContinueButton");a.ajax({type:"post",url:"/inlinepaymentwall/states-list-controller",success:function(b){g.handleStatesResponse(b),j.hideErrorMessages(),a("#spinner").addClass("hide"),i.postMessage("enableContinueButton")},data:{country:b,encryptedOM:a("#turing").val()},error:function(b,c,d){b.responseJSON&&"INVALID_OR_EXPIRED_TOKEN"===b.responseJSON.error?k.resolver(b.responseJSON.error):(g.resetCountryCode(),j.showTryAgain()),a("#spinner").addClass("hide"),i.postMessage("enableContinueButton")},timeout:3e4})}})}function x(){a("#first-name").on("blur",function(){e.isValidFirstName(),j.hideErrorMessages()}),a("#last-name").on("blur",function(){e.isValidLastName(),j.hideErrorMessages()})}function y(){a("#streetAddress1").on("blur",function(){f.isStreet1Entered(),j.hideErrorMessages()}),a("#city-name").on("blur",function(){f.isCityNameEntered(),j.hideErrorMessages()}),a("#zip-code").on("blur",function(){f.isZipCodeEntered(),j.hideErrorMessages()}),a("#country").on("blur",function(){f.isCountryChosen(),j.hideErrorMessages()}),a("#state").on("blur",function(){f.isStateChosen(),j.hideErrorMessages()})}function z(){a("#remembered-cards").change(function(){if(j.hideErrorMessages(),0===a('[id^="cc-row"]').length)if(a(".rememberedCardsContainer").remove(),a("#remember-card-div").removeClass("hide"),a(m.ccEntryForm).removeClass("hide"),b.supportsInstallments){d.showDefaultInstallments();var c=a("#credit-card-inline").val().replace(/\D/g,"");c&&(b.updatePreviousBin(""),a("#cardicon").attr("class","cardicon Generic"),a("#credit-card-inline").trigger("keydown"))}else d.showNoInstallment();else h.isRememberMeCreditCardSelections()||h.selectRememberMeCard(0,d,l)})}function A(){a(".link").on("click",function(){j.hideErrorMessages(),"no"===this.classList[1]?(a(this).closest('div[class^="confirm-remove"]').addClass("hide"),a(this).closest('td[class^="selection"]').find('span[id^="remove-card"]').show()):(a(this).closest('tr[id^="cc-row"]').remove(),a("#remembered-cards").trigger("change"),a(".add-card-row").removeClass("hide"))})}function B(b){a(b.currentTarget).attr("maxlength","19");var c=a(b.currentTarget).val();return c&&c.length>0&&(b.keyCode=c.charCodeAt(c.length-1),b.which=c.charCodeAt(c.length-1),a(b.currentTarget).val(c.substring(0,c.length-1))),b}function C(){a("#credit-card-inline").on({keydown:function(a){var b=a.keyCode||a.which;0!=b&&229!=b&&(l.validateCreditCard(a,!1,n),l.cscFormatter())},keyup:function(a){var b=a.keyCode||a.which;0!=b&&229!=b||(a=B(a),l.validateCreditCard(a,!1,n),l.cscFormatter())},blur:function(a){l.validateCreditCard(a,!0,n),l.cscFormatter(),j.hideErrorMessages()},paste:function(b){a("#cardicon").attr("class","cardicon Generic");var c="";return window.clipboardData?c=window.clipboardData.getData("text"):b.originalEvent&&b.originalEvent.clipboardData&&(c=b.originalEvent.clipboardData.getData("text")),a(b.currentTarget).val(c),l.validateCreditCard(b,!0,n),!1}})}function D(){a(m.cscEntries).on({keypress:l.validateCsc,keydown:l.validateCsc,blur:j.hideErrorMessages})}function E(){var a=function(){b.successfulTransaction||i.postMessage("onMiniBrowserClose"),i.postMessage("closeMiniBrowser")};window.onbeforeunload=a,window.onpagehide=a}function F(){a(document).ready(function(){d.grabInstallmentsDefaults(),setTimeout(function(){if(a(m.installmentDropDown).data("preselectTerm")){var b=".dropdown-menu li a[term="+a(m.installmentDropDown).data("preselectTerm")+"]";a(b).click()}},200),a("#error-box-installments-load").is(":visible")&&i.postMessage("installmentsIssue",{message:a("#error-box-installments-load").text()}),a("#miniBrowserContinueButton").click(o.doContinue),a("#credit-card-inline").keydown(function(b){-1!==a.inArray(b.keyCode,[c.keyboard.delete,c.keyboard.backspace,c.keyboard.tab,c.keyboard.escape,c.keyboard.enter])||b.keyCode===c.keyboard.a&&(!0===b.ctrlKey||!0===b.metaKey)||b.keyCode===c.keyboard.c&&(!0===b.ctrlKey||!0===b.metaKey)||b.keyCode===c.keyboard.x&&(!0===b.ctrlKey||!0===b.metaKey)||b.keyCode===c.keyboard.v&&(!0===b.ctrlKey||!0===b.metaKey)||b.keyCode>=c.keyboard.end&&b.keyCode<=c.keyboard.downArrow||(b.shiftKey||b.keyCode<c.keyboard.num0||b.keyCode>c.keyboard.num9)&&(b.keyCode<c.keyboard.numpad.num0||b.keyCode>c.keyboard.numpad.num9)&&b.preventDefault()})})}function G(a){try{var b=JSON.parse(a.data);switch(b.action){case"continue":o.doContinue();break;case"enableContinueButton":window.document.getElementById("miniBrowserContinueButton").disabled=!1;break;case"disableContinueButton":window.document.getElementById("miniBrowserContinueButton").disabled=!0;break;case"resizeHeightOfTheIframe":window.resizeTo(500,b.height+50),window.focus()}}catch(a){}}return{initialize:function(){q(),s(),t(),u(),v(),z(),A(),C(),D(),r(),E(),w(),x(),y()},registerInstallmentSelect:q,registerRememberedCardsSelection:t,registerCountryOnSelect:w,registerOnLoad:F,handleMessageEvent:G}});