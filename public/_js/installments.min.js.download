/*! ppplusbrcpmnodeweb 01-10-2021 */
define(["jquery","utility","messageController","cache","rememberMeHelper","domHelper","defaults"],function(a,b,c,d,e,f,g){"use strict";function h(){var b=a(document).find(".dropdown-toggle.installment-enabled"),c={};return this.hasInstallmentOptions()&&!a(f.installmentDropDown).hasClass("hide")||this.hasFixedInstallment()&&!a(f.fixedInstallmentOptionContainer).hasClass("hide")?(c=a(b).attr("data-pp-internal")||a(f.fixedInstallmentOption).attr("data-pp-internal"),void 0===c?"NoSelection":c):"NoInstallment"}function i(){a(f.installmentDropDown).removeClass("hide")}function j(){a(f.installmentDropDown).addClass("hide")}function k(b){b+=f.rememberMeInstallments,a(b).addClass("selectable-installment"),a(b).removeClass("hide")}function l(){a(f.rememberMeInstallments).removeClass("selectable-installment"),a(f.rememberMeInstallments).addClass("hide")}function m(){a(f.defaultInstallments).removeClass("selectable-installment"),a(f.defaultInstallments).addClass("hide")}function n(){a(f.defaultInstallments).addClass("selectable-installment"),a(f.defaultInstallments).removeClass("hide")}function o(){a(f.ccEntryInstallments).removeClass("selectable-installment"),a(f.ccEntryInstallments).addClass("hide")}function p(){a(f.ccEntryInstallments).addClass("selectable-installment"),a(f.ccEntryInstallments).removeClass("hide")}function q(){a(f.singleInstallment).removeClass("hide")}function r(){a(f.singleInstallment).addClass("hide")}function s(){a(f.singleInstallment).removeClass("hide")}function t(){a(f.fixedInstallmentOptionContainer).removeClass("hide"),a(f.fixedInstallmentOption).removeClass("hide")}function u(){a(f.fixedInstallmentOptionContainer).addClass("hide"),a(f.fixedInstallmentOption).addClass("hide")}function v(){j(),o(),r(),l(),u(),m()}function w(){v(),a("#installmentDisabled").removeClass("hide")}function x(a){v(),i(),k(a)}function y(){v(),q()}function z(){e.hideRememberMeCsc(),v(),i(),p()}function A(){e.hideRememberMeCsc(),v(),i(),n()}function B(){e.hideRememberMeCsc(),v(),s()}function C(){v(),t()}function D(){return 0!==a(f.fixedInstallmentOptionContainer).length}function E(){return 0!==a(f.installmentDropDown).length}function F(b){var c,d,e=a(document).find(".dropdown-menu .installment-row:not(.hide) .row"),f=a(document).find(".dropdown-toggle.installment-enabled");if(e.length>=b){c=G(e,b),d=a(c).find(".installment-term").text();d=d+' <span class="saveThis">'+(a(c).find(".discount").text()||"")+"</span>",a(f).html(d)}}function G(b,c){return a.grep(b,function(a){return a.textContent.charAt(0)===c})[0]}function H(b,c){var d=a(document).find(".dropdown-toggle.installment-enabled");a(d).attr("data-pp-internal",c),a(d).attr("term",b)}function I(b,c,d){c?s():d?C():(a(f.ccEntryInstallments).remove(),a(f.installmentOptionsContainer).append(b),z(),J())}function J(){a(".dropdown-menu li a").click(function(){var e,f=a(this).parents(".btn-group").find(".dropdown-toggle"),g=a(f).get(0).id||"";if("select-installments"===g){e=a(this).find(".installment-term").text();e=e+' <span class="saveThis">'+(a(this).find(".discount").text()||"")+"</span>",d.lastSelectedTerm=a(this).attr("term"),H(a(this).attr("term"),a(this).attr("data-pp-internal"))}else e=a(this).text();a(f).html(e),a(f).removeClass("select-error"),c.hideErrorMessages(),a("#spinner").addClass("hide"),b.postMessage("enableContinueButton")})}function K(){a(".installmentsContainer").find(".default-installments.installment-row").length>0?(d.isDefaultInstallmentsLoaded=!0,d.supportsInstallments=!0,d.defaultType=g.MULTIPLE_INSTALLMENTS):D()?(d.supportsInstallments=!0,d.defaultType=g.FIXED_INSTALLMENTS):d.defaultType=g.SINGLE_OPTION}function L(){return a(".installmentsContainer").find(".default-installments.installment-row").length>0}function M(){d.supportsInstallments&&(d.isDefaultInstallmentsLoaded=!0,D()?C():n())}function N(e){var f="default";if(e.success)e.ccNumber&&(e.ccNumber=e.ccNumber.substr(0,g.binSize)),e.loadDefaults?d.defaultType===g.MULTIPLE_INSTALLMENTS?(M(),A()):d.defaultType===g.FIXED_INSTALLMENTS?C():B():e.singleInstallment?(f="Single Installments",d.isDefaultInstallmentsLoaded=!1,w(),d.updateBinInfoMap(e.ccNumber,{isSingle:!0})):e.fixedInstallment?(f="Fixed installment",d.isDefaultInstallmentsLoaded=!1,C(),d.updateBinInfoMap(e.ccNumber,{installments:e.payload,isFixed:!0})):e.multipleInstallment&&(f="Multiple installment",d.isDefaultInstallmentsLoaded=!1,I(e.payload,!1),J(),d.updateBinInfoMap(e.ccNumber,{installments:e.payload,isSingle:!1})),a(".installmentsContainer").trigger("change"),b.log("handleInstallmentsResponse: success "+f,"debug");else{var h=e.responseJSON.err||e.responseJSON.error;h=h.message||h,b.log("doInstallmentsOptionsGet: fail "+h,"debug"),"INVALID_OR_EXPIRED_TOKEN"===h&&c.showSessionExpired(),d.isDefaultInstallmentsLoaded=!1,s(),y(),c.showFailInstallmentsGet()}}return{getSelectedInstallmentTerm:h,selectInstallmentTerm:H,loadInstallment:F,insertInstallments:I,showRememberMeInstallments:x,showRememberMeSingleInstallmentOption:y,showCcEntrySingleInstallmentOption:B,showCcEntryInstallments:z,showCcFixedInstallmentOption:C,registerInstallmentSelect:J,disableInstallmentOptions:w,getInstallmentByTerm:G,hasInstallmentOptions:E,hasFixedInstallment:D,grabInstallmentsDefaults:K,acceptsInstallments:L,loadInstallmentDefaults:M,handleInstallmentsResponse:N,hideDefaultInstallmentsSelection:m,showDefaultInstallmentsSelection:n,showDefaultInstallments:A}});