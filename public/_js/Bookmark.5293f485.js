"use strict";function _classCallCheck(o,a){if(!(o instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(o,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function _createClass(o,a,t){return a&&_defineProperties(o.prototype,a),t&&_defineProperties(o,t),o}var Bookmark=function(){function o(){_classCallCheck(this,o),this.lightcardBookmarkButton=$(".lightCard-bookmark"),this.bookmarkButton=$(".bookmark-button"),this.courseBookmarkButton=$(".course-bookmark-button"),this.careerCourseBookmarkButton=$(".career-courses__bookmark"),this.learningGuideBookmarkButton=$(".btn-seguir"),this.studyPlanB2BBookmarkButton=$(".study-plan__follow-button"),this.bookmarkCounter=$(".bookmark-counter"),this.bookmarkCounterValue=this.bookmarkCounter?parseInt(this.bookmarkCounter.html()):0,this.ajaxLoading=!1,this.bookmarkMessages={showOnDashboard:"Exibir na Dashboard",showingOnDashboard:"Exibindo na Dashboard"}}return _createClass(o,[{key:"lightcardBookmarkClick",value:function(o){var a=this,t=$(o.currentTarget),r=t.attr("data-course-code");this.post(o,r,function(){t.find(".lightCard-bookmark-checked-icon, .lightCard-bookmark-unchecked-icon").toggle(),a.ajaxLoading=!1})}},{key:"setMessages",value:function(o,a){this.bookmarkMessages={showOnDashboard:o,showingOnDashboard:a}}},{key:"bookmarkClick",value:function(o){var a=this,t=$(o.currentTarget),r=t.data("course-code");this.post(o,r,function(){"true"==t.attr("data-bookmarked")?(t.html(t.attr("data-bookmark-display")),t.attr("data-bookmarked",!1),t.removeClass("bookmark-button--bookmarked")):(t.html(t.attr("data-unbookmark-display")),t.attr("data-bookmarked",!0),t.addClass("bookmark-button--bookmarked")),a.ajaxLoading=!1})}},{key:"courseBookmarkClick",value:function(o){var a=this,t=$(o.currentTarget),r=t.data("course-code");this.post(o,r,function(){"true"==t.attr("data-bookmarked")?(t.find("h2").text(t.attr("data-bookmark-display")),t.attr("data-bookmarked",!1),t.removeClass("course-bookmark-button--bookmarked"),t.parent().attr("data-bookmarked",!1)):(t.find("h2").text(t.attr("data-unbookmark-display")),t.attr("data-bookmarked",!0),t.addClass("course-bookmark-button--bookmarked"),t.parent().attr("data-bookmarked",!0)),a.ajaxLoading=!1})}},{key:"careerCourseBookmarkClick",value:function(o){var a=this,t=$(o.target),r=t.attr("data-course-code");o.preventDefault(),o.stopPropagation(),this.post(o,r,function(){t.toggleClass("career-courses__bookmark--bookmarked"),a.ajaxLoading=!1},!0)}},{key:"studyPlanB2BClick",value:function(o){var a=$(o.target),o=a.attr("data-guide-code"),t="true"===a.attr("data-bookmarked");this.requestB2B(o,function(){a.toggleClass("study-plan__follow-button--following"),a.attr("data-bookmarked",!t),this.ajaxLoading=!1}.bind(this),t)}},{key:"updateCounter",value:function(o){this.bookmarkCounter&&(o?--this.bookmarkCounterValue:this.bookmarkCounterValue+=1,this.bookmarkCounter.text(this.bookmarkCounterValue))}},{key:"learningGuideBookmarkClick",value:function(o){var e=this;o.preventDefault(),o.stopPropagation();var n=$(o.currentTarget.parentNode),a=n.attr("data-guide-id"),i="true"==n.attr("data-is-bookmarked").toLowerCase(),k=i?"rgba(0, 0, 0, 0.3)":"#FFF",s=i?"rgba(0, 0, 0, 0.3)":"#FFF",u=i?"rgba(0, 0, 0, 0.3)":n.css("color"),d=i?this.bookmarkMessages.showOnDashboard:this.bookmarkMessages.showingOnDashboard,a="/learningGuide/".concat(a,"/")+(i?"unbookmark":"bookmark");this.learningGuideBookmarkPost(o,a,function(){e.updateCounter(i);var o=n.find(".btn-seguir-slider"),a=n.find(".sliderDegree"),t=n.find(".sliderStudyPlan"),r=n.find(".sliderCorpPlan");n.find(">:first-child").text(d),o.css("background-color",k),a.css("background-color",s),t.css("background-color",u),r.css("background-color",s),o.toggleClass("btn-seguir-slider--checked"),n.attr("data-is-bookmarked",!i),e.ajaxLoading=!1},!0)}},{key:"post",value:function(o,a,t){this.ajaxLoading||(this.ajaxLoading=!0,a={courseCode:a},$.post("/courses/toggle-bookmark",a).done(function(){t()}).fail(function(){window.alert("Ocorreu um erro!")}))}},{key:"requestB2B",value:function(o,a,t){this.ajaxLoading||(this.ajaxLoading=!0,t="learningGuide/".concat(o,t?"/unbookmark":"/bookmark"),$.post(t,a))}},{key:"learningGuideBookmarkPost",value:function(o,a,t){this.ajaxLoading||(this.ajaxLoading=!0,$.post(a).done(function(){t()}).fail(function(){window.alert("Ocorreu um erro! Por favor, tente novamente.")}))}},{key:"refreshListener",value:function(){this.lightcardBookmarkButton.on("click",this.lightcardBookmarkClick.bind(this)),this.bookmarkButton.on("click",this.bookmarkClick.bind(this)),this.courseBookmarkButton.on("click",this.courseBookmarkClick.bind(this)),this.careerCourseBookmarkButton.on("click",this.careerCourseBookmarkClick.bind(this)),this.learningGuideBookmarkButton.on("click",this.learningGuideBookmarkClick.bind(this)),this.studyPlanB2BBookmarkButton.on("click",this.studyPlanB2BClick.bind(this))}}]),o}();