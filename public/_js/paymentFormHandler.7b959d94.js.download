"use strict";var PaymentFormHandler=function(t){var r={};return r.paymentForm=t,r.paymentFormValidator=new PaymentFormValidator(r.paymentForm),"undefined"!=typeof Paypal&&(r.paypal=new Paypal(r.paymentForm),r.paypal.loadPPPFrame()),"undefined"!=typeof Braintree&&(r.braintree=new Braintree(r.paymentForm)),r.throttleAttempt=function(n){var o=this,m=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2e3;return function(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];r.timeout||(r.timeout=setTimeout(function(){n.apply(o,e),r.timeout=null},m))}},r.paymentForm.buttons.goToPaymentButton.on("click",function(t){var e=$(this);if("click"===t.type||(t.type="cpf"===e.attr("id")))if(r.paymentFormValidator.validateAllFields()){if(r.paymentForm.hasGoogleTagManager&&dataLayer.push({event:"informacoesOk"}),r.paymentForm.hasPaypalError)return r.paymentForm.buttons.stepSubmit.addClass("step-submit--disabled"),void r.paymentForm.goToComunicationFailure();r.paymentForm.buttons.stepSubmit.removeClass("step-submit--disabled"),$(".form-step-paypalFrame").addClass("form-step-paypalFrame--hidden"),"undefined"!=typeof Paypal&&(r.paypal.loadPPPFrame(),setTimeout(function(){r.paymentForm.goToPaypalStep()},1e3)),"undefined"!=typeof Braintree&&r.braintree.build()}else t.preventDefault(),r.paymentForm.buttons.stepSubmit.addClass("step-submit--disabled")}),r.paymentForm.buttons.completePayment.on("click",function(t){t.preventDefault(),r.paymentFormValidator.validateAllFields()?(r.savePurchaseAttempt(),r.paypal.getPPP().doContinue(),r.paymentForm.addLoadingToPaypalButton(),setTimeout(function(){r.paymentForm.removeLoadingFromPaypalButton()},1e4)):$(this).addClass("step-submit--disabled")}),r.paymentForm.buttons.stepLinkTryAgain.on("click",function(t){return"#"!==$(this).attr("href")||(t.preventDefault(),void r.paymentForm.goToBegin())}),r.savePurchaseAttempt=function(){var t;r.paymentForm.email()&&(t={paymentId:r.paymentForm.paymentId,buyerEmail:r.paymentForm.email(),buyerDocument:r.paymentForm.cpf(),buyerName:r.paymentForm.fullName(),buyerPhone:r.paymentForm.phone(),productId:r.paymentForm.productId,discountCode:r.paymentForm.discountCode,usernameIndicate:r.paymentForm.usernameIndicate,braintreeClientToken:$(".payment-info").data("braintree-client"),status:"CREATED"},$.post("/purchase/attempt/save",t))},r.paymentForm.inputs.cpf.on("input",function(){var t=$(this);$(this).val(t.val().replace(/\D/g,""))}),r.paymentForm.inputs.name.on("input",function(){$(".payment-paypalFrame").removeClass("form-paypal--active")}),r.paymentForm.inputs.isForeigner.on("change",function(){$(this).is(":checked")?($(".step-error-message").removeClass("step-error--visible"),r.paymentForm.inputs.cpf.removeClass("step-input--error"),r.paymentForm.inputs.cpf.val(""),r.paymentForm.inputs.cpf.prop("disabled",!0),r.paymentFormValidator.validateAllFields()&&r.paymentForm.buttons.goToPaymentButton.removeClass("step-submit--disabled")):($(".step-error-message").addClass("step-error--visible"),r.paymentForm.inputs.cpf.addClass("step-input--error"),r.paymentForm.buttons.goToPaymentButton.addClass("step-submit--disabled"),r.paymentForm.inputs.cpf.prop("disabled",!1))}),r.paymentForm.inputs.changeEmail.on("click",function(t){t.preventDefault(),r.paymentForm.inputs.email.prop("disabled",!1),$.get("/signout")}),r.paymentForm.inputs.name.focusout(r.throttleAttempt(r.savePurchaseAttempt)),r.paymentForm.inputs.email.focusout(r.throttleAttempt(r.savePurchaseAttempt)),r.paymentForm.inputs.cpf.focusout(r.throttleAttempt(r.savePurchaseAttempt)),r.paymentForm.inputs.phone.focusout(r.throttleAttempt(r.savePurchaseAttempt)),r.paymentForm.inputs.name.on("blur",r.paymentFormValidator.isValidName),r.paymentForm.inputs.email.on("blur",r.paymentFormValidator.isValidEmail),r.paymentForm.inputs.cpf.on("blur",r.paymentFormValidator.isValidCPF),{paymentForm:r.paymentForm}};