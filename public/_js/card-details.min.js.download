/*! ppplusbrcpmnodeweb 01-10-2021 */
define(["jquery","cache","utility","messageController","installmentsHelper","resolutionHelper","defaults","creditCardHelper"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){var c=h.getCardMetaData();return h.cscFormatter(c),!a||b.previousBin===a.replace(/\s+/g,"").substr(0,g.binSize)&&h.getCreditCardIcon()!==g.GENERIC||j(c,a),c}function j(i,j){if(void 0===i&&(i=h.getCardMetaData()),void 0===j&&(j=a("#credit-card-inline").val().replace(/\D/g,"")),j.replace(/\s+/g,"").length>=15&&h.formatCardNumberWithSpaces(),b.contains(j)&&b.getCard(j).type!==g.UNSUPPORTED&&b.getCard(j).type!==g.GENERIC){i=b.getCard(j);var k=b.getInstallment(j);a(".cardicon").attr("class","cardicon "+i.type),e.isDefaultInstallmentsLoaded=!1,!k||k.isSingle?e.disableInstallmentOptions():!k||k.isFixed?e.showCcFixedInstallmentOption():(e.insertInstallments(k.options,!1),e.registerInstallmentSelect())}else a.ajax({type:"post",url:"/inlinepaymentwall/card-type-installments-controller",success:function(c){i=h.getCardMetaData(c.type),a(".cardicon").attr("class","cardicon "+i.type),a("#credit-card-inline").trigger("focusout"),b.updateBinInfoMap(j,{card:i}),"Unsupported"===i.type?(d.showUnsupportedCreditCard(),b.updatePreviousBin(j.replace(/\s+/g,"").substr(0,g.binSize)),b.failedRequests.creditcardtype=!1):"error"===c.msg?b.failedRequests.creditcardtype=!0:c.success?(d.hideUnsupportedCreditCard(),b.failedRequests.creditcardtype=!1,b.updatePreviousBin(j.replace(/\s+/g,"").substr(0,g.binSize)),h.cscFormatter(i)):b.failedRequests.creditcardtype=!0,e.handleInstallmentsResponse(c)},data:{creditCard:j.replace(/\s+/g,"").substring(0,g.binSize),encryptedOM:a("#turing").val()},error:function(d,g,h){b.failedRequests.creditcardtype=!0,c.log(f.parseCcTypeErrMsg(d,h),"debug"),d.responseJSON&&"INVALID_OR_EXPIRED_TOKEN"===d.responseJSON.error&&f.sendOnError(d.responseJSON.error),a("#cardicon").attr("class","cardicon Generic"),b.supportsInstallments&&(e.showDefaultInstallments(),e.registerInstallmentSelect())},timeout:3e4})}return{handleCreditCardType:j,getCreditCardType:i}});