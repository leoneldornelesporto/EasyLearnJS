"use strict";var Paypal=function(s){var n={ppp:null,paymentAnalytics:new PaymentAnalytics(s),successPurchaseEvents:new SuccessPurchaseEvents,getPPP:function(){return n.ppp},successPurchase:function(e){s.showLoadingCover(),(new PaypalPaymentValidator).validate(e),$.post("/payment/execute",e,function(e){s.hideLoadingCover(),e.problemToDeliver?s.goToFailToDelivery():s.goToSuccessStep();try{n.paymentAnalytics.doAllAnalytics(e),n.successPurchaseEvents.doAllEvents(e)}catch(e){console.error("could not send info to analytics")}}).fail(function(e,a,t){n.failPurchase(e.responseJSON)})},failPurchase:function(e){s.hideLoadingCover(),n.paymentAnalytics.sendFail(e.name),"PAYMENT_RESTRICTION"===e.name?s.goToFailStep():"INTERNAL_SERVICE_ERROR"===e.name?s.goToTechnicalFailure():s.goToPaypalFailure()},processMessage:function(e){try{console.log(e.data);var a,t=JSON.parse(e.data);void 0!==t.cause&&(s.removeLoadingFromPaypalButton(),localStorage.setItem("payerFirstName",s.firstName()),localStorage.setItem("payerLastName",s.lastName()),localStorage.setItem("payerEmail",s.inputs.email.val()),localStorage.setItem("payerTaxId",s.inputs.cpf.val()),$.post("/purchase/attempt/fail",{buyerEmail:s.inputs.email.val(),failCause:t.cause}).done(function(){return console.log("Purchase attempt failed: ",t.cause)}).fail(function(){return console.log("Failed to update purchase attempt status")}),s.goToIFrameFailure()),void 0!==t.result&&"APPROVED"===t.result.state&&(s.removeLoadingFromPaypalButton(),a={payerID:t.result.payer.payer_info.payer_id,email:s.inputs.email.val(),document:s.inputs.cpf.val(),firstName:s.firstName(),lastName:s.lastName(),phone:s.inputs.phone.val(),paymentID:$(".payment-info").data("paymentid"),discountCode:$(".payment-info").data("discountcode"),usernameIndicate:$(".payment-info").data("usernameindicate")},n.successPurchase(a),document.forms.executeForm.submit())}catch(e){console.error("Erro ao processar a mensagem do Paypal",e)}},loadPPPFrame:function(){$(".pplus-loading").show();var e={approvalUrl:$("#approval_url").val(),placeholder:"ppplus",payerFirstName:s.firstName()||"first",payerLastName:s.lastName()||"second",payerEmail:s.inputs.email.val()||"first@request.com",payerTaxId:s.inputs.cpf.val()||"12345678909",payerTaxIdType:$("#payerTaxIdType").val(),country:$("#country").val(),language:$("#language").val(),mode:$(".payment-info").data("paypal-mode"),onContinue:s.removeLoadingFromPaypalButton,buttonLocation:"inside"};$(".payment-info").data("fixed-instalment")&&(e.merchantInstallmentSelection=1,e.merchantInstallmentSelectionOptional=!$(".payment-info").data("fixed-instalment")),n.ppp=PAYPAL.apps.PPP(e),setTimeout(function(){$(".pplus-loading").fadeOut()},2e3)}};if(window.addEventListener)window.removeEventListener("message",n.processMessage,!1),window.addEventListener("message",n.processMessage,!1);else{if(!window.attachEvent)throw new Error("Can't attach message listener");window.detachEvent("onmessage",n.processMessage),window.attachEvent("onmessage",n.processMessage)}return{successPurchase:n.successPurchase,processMessage:n.processMessage,getPPP:n.getPPP,loadPPPFrame:n.loadPPPFrame}};