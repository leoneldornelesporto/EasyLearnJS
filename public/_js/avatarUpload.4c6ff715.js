"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var AvatarUpload=function(){function a(e,t,r){_classCallCheck(this,a),this._imageClient=e,this._avatarInput=document.querySelector("#avatar-value"),this._avatarPhoto=document.querySelectorAll(".headline-profile-avatar"),this._avatarSourceUrl=r,this._upload=document.querySelector("#avatar-upload"),this._file=document.querySelector("#avatar-upload-file"),this._remove=document.querySelector("#avatar-remove"),this._progress=new UploadProgress(t.progressMessage).avatarUpload(),this._openModal=document.querySelectorAll(".avatar-open-modal"),this._modal=document.querySelector("#avatar-modal"),this._closeModal=document.querySelector("#avatar-close-modal"),this._error=document.querySelector(".avatar__form .alert"),this._errorMessage=document.querySelector(".avatar__form .alert .alert-message"),this._messages=t}return _createClass(a,[{key:"refreshListeners",value:function(){var t=this;this._remove.addEventListener("click",function(e){return t.remove(e)}),this._file.addEventListener("change",function(e){return t.upload(e)}),this._upload.addEventListener("click",function(e){return t._file.click()}),this._openModal.forEach(function(e){return e.addEventListener("click",function(e){return t.openModal(e)})}),this._closeModal.addEventListener("click",function(e){return t.closeModal(e)})}},{key:"remove",value:function(e){var t=this;e.preventDefault(),this._avatarInput.value="",$.post("/user/avatar/remove").done(function(e){t.changePhoto(e.path),t._avatarSourceUrl.changeSourcePhoto(e),t._remove.classList.add("--disabled"),t._remove.setAttribute("disabled","true")}).fail(function(e){return console.log(e)})}},{key:"changePhoto",value:function(t){return this._avatarPhoto.forEach(function(e){return e.src=t})}},{key:"upload",value:function(e){var t=this;this.hideError();var r=e.target.files;1===r.length&&(2048<=(e=r[0]).size/1024?this.showError("large-file"):(this._progress.build(r),this._imageClient.upload(e,this._progress).then(function(e){return t.changeUserAvatar(e)}).catch(function(e){return t.showError(e.code)}).finally(function(){return t._progress.reset()})))}},{key:"changeUserAvatar",value:function(e){var t=this,e=e.paths[1];$.ajax("/user/avatar/add",{data:JSON.stringify({url:e}),contentType:"application/json",type:"POST"}).done(function(e){t.changePhoto(e.path),t._avatarSourceUrl.changeSourcePhoto(e),t._avatarInput.value=e.path.split("?")[0],t._remove.classList.remove("--disabled"),t._remove.removeAttribute("disabled")}).fail(function(e){console.error(JSON.stringify(e))})}},{key:"openModal",value:function(e){e.preventDefault(),this._modal.classList.add("show")}},{key:"closeModal",value:function(e){e.preventDefault(),this._modal.classList.remove("show")}},{key:"showError",value:function(e){this._errorMessage.text=this._messages[e],this._error.classList.add("show")}},{key:"hideError",value:function(){this._error.classList.remove("show"),this._errorMessage.text=""}}]),a}();