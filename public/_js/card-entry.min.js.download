/*! ppplusbrcpmnodeweb 01-10-2021 */
define(["jquery","cache","utility","defaults","domHelper","messageController","installmentsHelper"],function(a,b,c,d,e,f,g){"use strict";function h(b){var c=e.getCsc();b||(b=i()),a.each(c,function(c,d){a(d).attr("maxlength",b.cvcLength),a(d).attr("placeholder",b.cvcLength+a(d).attr("placeholder").substring(1))})}function i(b){var c=b;b||(c=j());var d=m.CARD_CONSTRAINT_LIST,e=m.GENERIC_CARD;return a.each(d,function(a,b){c!==b.type&&c.toUpperCase()!==b.type||(e=b)}),e}function j(){return document.getElementById("cardicon").className.replace("cardicon ","")}function k(a){a=a||window.event;var b=a.which?a.which:a.keyCode;return b>=96&&b<=105||!(b>31)||!(b<48||b>57)}function l(e,j,k){var l,m,o="",p=a("#credit-card-inline").val(),q=a("#credit-card-inline").val(),r=a("#credit-card-inline").get(0),s=r.selectionStart,t=r.selectionEnd,u=!1;c.log(e,"debug");var v=function(a){return a>=d.keyboard.num0&&a<=d.keyboard.num9||a>=d.keyboard.numpad.num0&&a<=d.keyboard.numpad.num9};e.keyCode||e.originalEvent?m=e.keyCode||e.originalEvent.keyCode:j=!0,e.isTrigger&&(u=!0);var w=i(),x=s>=0||t<=d.binSize;if(!j){e=e||window.event;var y=e.which?e.which:m;v(y)&&(o=String.fromCharCode(y>=d.keyboard.numpad.num0&&y<=d.keyboard.numpad.num9?e.which-48:e.which))}if(p=p.replace(/\D/g,""),m!==a.ui.keyCode.BACKSPACE&&m!==a.ui.keyCode.DELETE&&(m!==d.keyboard.x||!0!==e.ctrlKey&&!0!==e.metaKey)||(p.length<d.binSize||s<d.binSize||t<d.binSize)&&(x=!0,a("#cardicon").attr("class","cardicon Generic"),b.supportsInstallments&&(g.hasFixedInstallment()?g.showCcFixedInstallmentOption():(g.showDefaultInstallments(),g.registerInstallmentSelect()))),m!==a.ui.keyCode.DOWN&&m!==a.ui.keyCode.END&&m!==a.ui.keyCode.ESCAPE&&m!==a.ui.keyCode.HOME&&m!==a.ui.keyCode.LEFT&&m!==a.ui.keyCode.PAGE_DOWN&&m!==a.ui.keyCode.PAGE_UP&&m!==a.ui.keyCode.PERIOD&&m!==a.ui.keyCode.RIGHT&&m!==a.ui.keyCode.SPACE&&m!==a.ui.keyCode.TAB&&m!==a.ui.keyCode.UP){"paste"===e.type?l=p:j?l=p:(l=q.substr(0,s)+o+q.substr(t+o.length-1),l=l.replace(/\D/g,""));var z=a("#cardicon").hasClass("cardicon Generic"),A="blur"===e.type&&l.length>=d.binSize&&z;l.length>=d.binSize&&(x||a("#cardicon").hasClass("cardicon Generic"))&&(s<=d.binSize&&s>=0&&v(y)||u||"paste"===e.type||A)&&(w=k.getCreditCardType(l)),(A||v(y))&&(a("#credit-card-inline").val(l),n(),e.preventDefault()),p.length>=d.binSize&&(b.previousBin=p.substr(0,d.binSize)),w&&"Unsupported"===w.type?f.showUnsupportedCreditCard():f.hideUnsupportedCreditCard(),h()}}var m={CARD_CONSTRAINT_LIST:[{type:"MSTRO",name:"MSTRO",pattern:/^(5018|5020|5038|4903|4911|4936|564182|545250|504834|503615|6333|6304|6759|676[1-3]|0604)/,length:[12,13,14,15,16,17,18,19],minLength:12,cvcLength:3,upperLength:23,luhn:!0,spaceIndexes:[4,8,12,16,19],fields:["cardIssueInfo"]},{type:"DISC",name:"DISC",pattern:/^(6011|65|64[4-9]|622)/,length:[16],minLength:16,upperLength:19,cvcLength:3,spaceIndexes:[4,8,12,16],luhn:!0},{type:"MCARD",name:"MCARD",pattern:/^5[1-5]/,length:[16],minLength:16,upperLength:19,cvcLength:3,spaceIndexes:[4,8,12,16],luhn:!0},{type:"AMEX",name:"AMEX",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],minLength:15,cvcLength:4,upperLength:17,spaceIndexes:[4,10,15],luhn:!0},{type:"VISA",name:"VISA",pattern:/^4/,length:[12,13,14,15,16,17,18,19],minLength:13,cvcLength:3,upperLength:19,spaceIndexes:[4,8,12,16],luhn:!0},{type:"ELO",name:"ELO",pattern:/^9/,length:[13,14,15,16],cvcLength:3,minLength:16,upperLength:19,spaceIndexes:[4,8,12,16],luhn:!0},{type:"HIPER",name:"HIPER",pattern:/^6/,length:[13,14,15,16],cvcLength:3,minLength:16,upperLength:19,spaceIndexes:[4,8,12,16],luhn:!0},{type:"HIPERCARD",name:"HIPERCARD",pattern:/^7/,length:[13,14,15,16],cvcLength:3,minLength:16,upperLength:19,spaceIndexes:[4,8,12,16],luhn:!0},{type:"Unsupported",name:"Unsupported",format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[16],minLength:15,maxLength:16,cvcLength:3,spaceIndexes:[4,8,12,16],luhn:!0},{GENERIC_CARD:{type:"Generic",name:"Credit Card",format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[16],minLength:16,maxLength:16,cvcLength:3,spaceIndexes:[4,8,12,16],luhn:!0}}],GENERIC_CARD:{type:"Generic",name:"Credit Card",format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[16],minLength:16,maxLength:16,cvcLength:3,spaceIndexes:[4,8,12,16],luhn:!0}},n=function(){var b=a("#credit-card-inline").val(),c=[],d=[4,8,12,16];/^3[47]/.test(b)&&(d=[4,10,15]);var e=b.length,f=0;b=b.replace(/\D/g,""),a.each(d,function(a,g){if(!(e>g))return a<d.length?c.push(b.slice(f,g)):c.push(b.slice(f)),!1;c.push(b.slice(f,g)),f=g}),a("#credit-card-inline").val(c.join(" "))};return{getCardMetaData:i,cscFormatter:h,formatCardNumberWithSpaces:n,getCreditCardIcon:j,validateCsc:k,validateCreditCard:l}});